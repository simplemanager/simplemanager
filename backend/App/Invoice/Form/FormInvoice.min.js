function updateInvoiceForm(i,j){var g=typeof i!=="number"?false:$("#root"+i);var f=typeof i!=="number"?false:g.find('[name="pd'+i+'"]');if(typeof j!=="object"){if(typeof $.pdopts==="object"&&$.pdopts.length){j=$.pdopts}}if(f===false||f.val()){var e=typeof i==="number"?i+1:0;if($("#root"+e).length===0){var h='<div id="root[NUM]"><div class="row"><div class="col-xs-12 col-sm-12 col-lg-12"><div class="form-group input-group"><div class="input-group-addon" onclick="toggleSubform([NUM])"><i id="card[NUM]" class="fa fa-chevron-down clickable"></i><i id="caru[NUM]" class="fa fa-chevron-up clickable" style="display: none"></i></div><select class="selectized" name="pd[NUM]" style="display: none"></select><div class="input-group-addon" style="width: 10%; min-width: 50px"><input type="number" name="pq[NUM]" placeholder="Qté" value="" class="form-control" style="border: 0; height: 30px;"></div><div class="input-group-addon" data-toggle="tooltip" data-original-title="" title="Supprimer" style="border-left: 0" onclick="delPr([NUM])"><i id="pdel[NUM]" class="fa fa-times text-gray psuppr clickable"></i></div><input type="hidden" name="ph[NUM]"></div></div></div><div class="row" id="compl[NUM]" style="display: none"><div class="col-xs-12 col-sm-3 col-lg-3"><div class="form-group"><div class="input-group"><label class="input-group-addon" for="price"><i class="fa fa-eur"></i></label><input step="0.01" type="number" required="" placeholder="Prix" name="pp[NUM]" data-toggle="tooltip" data-placement="bottom" data-original-title="" class="form-control" title="Laisser vide pour utiliser le prix par défaut (sauf création de produit). Fixer un prix différent pour ce document ne modifiera pas le prix par défaut de votre produit."></div></div></div><div class="col-xs-12 col-sm-3 col-lg-3" style="display: block;"><div class="form-group"><div class="input-group"><div class="input-group-addon"><i class="fa fa-percent"></i></div><input type="number" placeholder="Remise" name="pr[NUM]" data-toggle="tooltip" class="form-control" data-placement="bottom" data-original-title="" title="Remise exceptionnelle pour ce document uniquement"></div></div></div><div class="col-xs-12 col-sm-6 col-lg-6"><div class="form-group"><textarea id="pdd[NUM]" name="pdd[NUM]" placeholder="Informations complémentaires" data-toggle="tooltip" data-placement="top" class="form-control" data-original-title="" title="Informations à insérer à côté du produit (dans ce document uniquement)" rows="1"></textarea></div></div></div></div>';var a=$(h.replace(/\[NUM\]/g,e));var c=a.find('select[name="pd'+e+'"]');c.selectize({allowEmptyOption:true,valueField:"id",labelField:"title",searchField:"search_content",createOnBlur:true,selectOnTab:true,options:[],placeholder:"Ajouter un produit",create:function(k,l){sfOpen(e);$('[name="ph'+e+'"]').val(k);let row={title:k,uid:-1,id:-1,code:"NEW",price:0,price_type:""};this.addOption(row);let result=l(row);return result},render:{option_create:function(l,k){return'<div class="create">Ajouter <strong>'+k(l.input)+"</strong>&hellip;</div>"},option:function(l,k){return"<div><strong>"+k(l.code)+'</strong> <span class="pull-right">'+k(l.price)+" "+k(l.price_type)+"</span><br /></span>"+k(l.title)+"</span></div>"}},load:function(k,l){if(!k.length){return l()}$.ajax({url:"/event/ac/product/"+encodeURIComponent(k),type:"GET",dataType:"json",error:function(){l()},success:function(m){l(m)}})},onChange:function(){let snum=parseInt(this.$input.attr("name").match(/\d+/g),10);updateInvoiceForm(snum);if(!$.pdinitialization){let $input=$('input[name="pq'+snum+'"]');if($input.val()===""){$input.val(1)}$input.focus().select()}}});if(typeof j==="object"&&j.length){var d=c[0].selectize;$.each(j,function(k,l){d.addOption(l)});$.pdopts=j}$mdBefore=$("textarea#md_before");a.find("div.selectize-input").css("border-right",0);var b=g!==false?g:$mdBefore.parent().parent().parent();b.after(a);autosize($('textarea[name="pdd'+e+'"]'));$(".psuppr").removeClass("text-gray").addClass("text-danger");$("#pdel"+e).removeClass("text-danger").addClass("text-gray");return a}}return g}function hydrateProducts(a){$.pdinitialization=true;$.each(a,function(c,f){c!==0?updateInvoiceForm(c-1):$("div#root0");var e=$("div#root"+c);let $pd=e.find('select[name="pd'+c+'"]');if(f.hasOwnProperty("pd")){let selectize=$pd[0].selectize;selectize.addOption(f.option);selectize.setValue(f.pd)}else{f.pd=""}var d=c;var b;$.each(f,function(h,g){if(["option","errors"].indexOf(h)!==-1){return}b=false;if(f.hasOwnProperty("errors")&&f.errors.hasOwnProperty(h)){let err=f.errors[h].join(" ");b=e.find('[name="'+h+d+'"]');let $prow=b.parents("div.form-group").addClass("has-error");if(h==="pd"){$prow.after('<div style="color: #e74c3c; margin: -10px 0 15px 0">'+err+"</div>")}else{$prow.append('<span class="help-block">'+err+"</span>")}sfOpen(c)}else{if(h==="pd"&&f.hasOwnProperty("info")){b=e.find('[name="'+h+d+'"]');let $prow=b.parents("div.form-group").addClass("has-success");$prow.after('<div style="color: #00a65a; margin: -10px 0 15px 0">'+f.info+"</div>")}}if(h!=="pd"){if(!b){b=e.find('[name="'+h+d+'"]')}b.val(g)}})});$.pdinitialization=false}function toggleSubform(a){if($("#card"+a).is(":visible")){sfOpen(a);autosize.update($("#pdd"+a))}else{sfClose(a)}}function sfOpen(a){$("#root"+a).css("background","#eee").css("margin","0 -10px 15px -10px").css("padding","15px 10px 0 10px");$("#compl"+a).fadeIn(250,function(){$("#compl"+a).show()});$("#card"+a).hide();$("#caru"+a).show()}function sfClose(a){$("#compl"+a).hide();$("#card"+a).show();$("#caru"+a).hide();$("#root"+a).css("background","").css("margin","0").css("padding","0")}function delPr(a){if($("#pdel"+a).hasClass("text-danger")){$("#root"+a).hide();$("input[name=ph"+a+"]").val(-1)}}function addRecipientSelectOpt(b,a){let $select=$('select[name="recipient"]');let selectize=$select[0].selectize;let option={id:b,title:a,tel:"(nouveau)"};selectize.addOption(option);selectize.setValue(b)};